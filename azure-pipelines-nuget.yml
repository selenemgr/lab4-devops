# ASP.NET Core (.NET Framework)
# Build and test ASP.NET Core projects targeting the full .NET Framework.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core

trigger:
- master

pool:
  vmImage: 'windows-latest'
  name: 'self-host'

variables:
  buildConfiguration: 'Release'
  projectPath: 'ShowCase/ShowCase.csproj'

steps:
  # Checkout the GitHub repo connected to this pipeline
  - checkout: self

  # Install .NET 8 SDK
  - task: UseDotNet@2
    inputs:
      packageType: sdk
      version: '8.0.x'
    displayName: 'Install .NET 8 SDK'

  # Authenticate with Azure Artifacts (for pushing NuGet packages)
  - task: NuGetAuthenticate@1
    displayName: 'Authenticate to Azure Artifacts'

  # Restore NuGet packages
  - script: dotnet restore $(projectPath)
    displayName: 'Restore dependencies'

  # Build the project
  - script: dotnet build $(projectPath) --configuration $(buildConfiguration) --no-restore
    displayName: 'Build project'

  # Pack the project into a NuGet package
  - script: dotnet pack $(projectPath) --configuration $(buildConfiguration) --no-build -o $(Build.ArtifactStagingDirectory)
    displayName: 'Pack NuGet package'

  # Push the NuGet package to Azure Artifacts
  - task: NuGetCommand@2
    inputs:
      command: push
      packagesToPush: '$(Build.ArtifactStagingDirectory)/*.nupkg'
      publishVstsFeed: 'Lab4-Feed'
    displayName: 'Push package to Azure Artifacts'